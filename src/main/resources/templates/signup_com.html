<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="An impressive and flawless site template that includes various UI elements and countless features, attractive ready-made blocks and rich pages, basically everything you need to create a unique and professional website.">
  <meta name="keywords"
    content="bootstrap 5, business, corporate, creative, gulp, marketing, minimal, modern, multipurpose, one page, responsive, saas, sass, seo, startup, html5 template, site template">
  <meta name="author" content="elemis">
  <title>Empty</title>
  <link rel="shortcut icon" href="./assets/img/favicon.png">
  <link rel="stylesheet" href="./assets/css/plugins.css">
  <link rel="stylesheet" href="./assets/css/style.css">
  <link rel="preload" href="./assets/css/fonts/noto2.css" as="style" onload="this.rel='stylesheet'">
</head>

<body>
  <div class="content-wrapper">
   <th:block th:replace="jy/header" ::header></th:block>
    <!-- /header -->
    <section class="wrapper bg-dark text-white">
      <div class="container pt-18 pt-md-20 pb-21 pb-md-21 text-center">
        <div class="row">
          <div class="col-lg-8 mx-auto">
            <h1 class="display-1 text-white mb-3">기업 회원가입</h1>
            <nav class="d-inline-block" aria-label="breadcrumb">
              <ol class="breadcrumb text-white">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Sign Up</li>
              </ol>
            </nav>
            <!-- /nav -->
          </div>
          <!-- /column -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container -->
    </section>
    <!-- /section -->

    <section class="wrapper bg-light">
      <div class="container pb-14 pb-md-16">
        <div class="row">
          <div class="col mt-n19">
            <div class="card shadow-lg">
              <div class="row gx-0 text-center">
                <div class="col-lg-6 image-wrapper bg-image bg-cover rounded-top rounded-lg-start d-none d-md-block" data-image-src="./assets/img/photos/tm3.jpg">
                </div>
                <!--/column -->
                <div class="col-lg-6">
                  <div class="p-10 p-md-11 p-lg-13">
                    <form class="text-start mb-3" action="signup_com" method="post" name="join_form2">
                    <h2 class="mb-3 text-start">기업 회원가입</h2>
                    <p class="lead mb-6 text-start">아이디 / 비밀번호 입력</p>
                      <div class="form-floating mb-4">
                        <input type="text" class="form-control w-75 float-start me-lg-5" placeholder="Name" id="id" name="id">
                        <label for="loginId">아이디 *</label>
                        <a href="#" class="btn btn-soft-primary btn-sm rounded-pill" onclick="checkId()" id = "id_check">중복확인</a>
                        </div>
                      <div class="form-floating mb-4">
                        <input type="password" class="form-control" placeholder="Name" id="pw" name="pw">
                        <span class="password-toggle"><i class="uil uil-eye"></i></span>
                        <label for="loginPassword">비밀번호 *</label>
                      </div>
                      <div class="form-floating mb-4">
                        <input type="email" class="form-control" placeholder="Email" id="email" name="email">
                        <label for="loginEmail">Email *</label>
                      </div>
<!--               -->
<!--                <div class="form-floating mb-4">-->
<!--                    <input type="text" class="form-control" placeholder="이름" id="name" name="name">-->
<!--                    <label for="loginEmail">이름 *</label>-->
<!--                  </div>-->
<!--                  <div class="form-floating mb-4">-->
<!--                    <input type="text" class="form-control" placeholder="닉네임" id="nick" name="nick">-->
<!--                    <label for="loginEmail">닉네임 *</label>-->
<!--                  </div>-->
                      <br>
                      <p class="lead mb-6 text-start">기업 정보 입력</p>
                      <div class="form-floating mb-4 ">
                    <input type="text" class="form-control w-75 float-start me-lg-5"  placeholder="Name" id="check_input" name="no" maxlength='10'>
                    <label for="loginName">사업자 등록번호</label>
                    <a type="button" class="btn btn-soft-primary btn-sm rounded-pill" id="check_btn">진위확인</a>
                  </div>
                      <div class="form-floating mb-4">
                        <input type="text" class="form-control" placeholder="Name" id="name" name="name">
                        <label for="loginName_com">회사명</label>
                      </div>
                      <div class="form-floating mb-4">
                        <input type="text" class="form-control" placeholder="Email" id="type" name="type">
                        <label for="loginType">업종명</label>
                      </div>
                      <div class="form-floating password-field mb-4">
                        <input type="text" class="form-control" placeholder="Password" id="opendate" name="opendate">
                        <label for="loginOpendate">개업일자</label>
                      </div>
                      <div class="form-floating password-field mb-4">
                        <input type="text" class="form-control" placeholder="Confirm Password" id="owner" name="owner">
                        <label for="loginCeo">대표명</label>
                      </div>
                       <input type="hidden" id="login_type" name="login_type" value="C">
                      <a class="btn btn-primary rounded-pill btn-login w-100 mb-2" type="button" onclick="joinform_check2();">Sign Up</a>
                    </form>
                    <!-- /form -->
                    </nav>
                    <!--/.social -->
                  </div>
                  <!--/div -->
                </div>
                <!--/column -->
              </div>
              <!--/.row -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /column -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container -->
    </section>
    <!-- /section -->
  </div>
  <!-- /.content-wrapper -->
  <th:block th:replace="jy/footer" ::footer></th:block>
  <div class="progress-wrap">
    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
      <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98" />
    </svg>
  </div>
  <script src="./assets/js/plugins.js"></script>
  <script src="./assets/js/theme.js"></script>
  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script>
  var gbl_data;
  var result_ck
  $(function(){
      $('#check_btn').click(function(){

          var check_val = $('#check_input').val();
          var data = {
              "b_no": [check_val] // 사업자번호 "xxxxxxx" 로 조회 시,
          };
          
          $.ajax({
            url: "https://api.odcloud.kr/api/nts-businessman/v1/status?serviceKey=WTuu0W1dJ4sq7hoRYcDCgKcHRQUaf6UajpAF8xtP%2Fv8PGrKCBEEhgvR5kauONv8s9PxPVjClHgy2mjAzNxB%2Fyw%3D%3D",  // serviceKey 값을 xxxxxx에 입력
            type: "POST",
            data: JSON.stringify(data), // json 을 string으로 변환하여 전송
            dataType: "JSON",
            contentType: "application/json",
            accept: "application/json",
            success: function(result) {
              if(result.data[0].tax_type=="국세청에 등록되지 않은 사업자등록번호입니다."){
                alert("잘못된 사업자 등록 번호입니다.");
                gbl_data = 0;
                if (gbl_data == "0"){
                    $("#check_input").val("");
                }
              }else {
                alert("사용가능한 사업자 등록 번호입니다.")
                gbl_data = 1;

              }
                /* alert(result.data[0].tax_type); */
            },
            error: function(result) {
                alert(result.responseText); //responseText의 에러메세지 확인
            }
          });


      });
  });
  function joinform_check2() {
      //변수에 담아주기
      var id = document.getElementById("id");
      var pw = document.getElementById("pw");
      var name = document.getElementById("name");
      var no = document.getElementById("check_input");
      var owner = document.getElementById("owner");
      var type = document.getElementById("type");


      if (id.value == "") { //해당 입력값이 없을 경우 같은말: if(!uid.value)
        alert("아이디를 입력하세요.");
        id.focus(); //focus(): 커서가 깜빡이는 현상, blur(): 커서가 사라지는 현상
        return false; //return: 반환하다 return false:  아무것도 반환하지 말아라 아래 코드부터 아무것도 진행하지 말것
      };

      if (pw.value == "") {
        alert("비밀번호를 입력하세요.");
        pw.focus();
        return false;
      };
		if (name.value == "") {
        alert("회사명을 입력하세요.");
        name.focus();
        return false;
      };
      if (check_input.value == "" || gbl_data == "0") {
    	    alert("올바른 사업자등록 번호을 입력하세요.");
    	    $("#check_input").val("");
    	    no.focus();
    	    return false;
    	}
      if (owner.value == "") {
          alert("대표명을 입력하세요.");
          owner.focus();
          return false;
          };
      if (type.value == "") {
          alert("사업직종을 입력하세요.");
          type.focus();
          return false;
      };
   /*    if (gbl_data = 0){
          alert("사업자 등록번호를 확인해주세요");
          $("#check_input").val("");
          return false;
      } */
      
      //입력 값 전송
        document.join_form2.submit();  //유효성 검사의 포인트   
    }
  function checkId(){
    var id = $('#id').val(); //id값이 "id"인 입력란의 값을 저장
    $.ajax({
        url:'./idCheck', //Controller에서 요청 받을 주소
        type:'post', //POST 방식으로 전달
        data:{id:id},
        success:function(cnt){ //컨트롤러에서 넘어온 cnt값을 받는다
            if(cnt == 0){ //cnt가 1이 아니면(=0일 경우) -> 사용 가능한 아이디
                $('.id_ok').css("display","inline-block");
                $('.id_already').css("display", "none");
                alert("사용가능한 아이디입니다");

            } else { // cnt가 1일 경우 -> 이미 존재하는 아이디
                $('.id_already').css("display","inline-block");
                $('.id_ok').css("display", "none");
                alert("아이디를 다시 입력해주세요");
                $('#id').val('');
            }
        },
        error:function(){
            alert("에러입니다");
        }
    });
  }
  
        </script>
</body>

</html>